!function(a,b){function c(){return Math.random()}function d(a){return Math.round(c()*a)}function e(a,b){return a+d(b)}function f(a,b,c,e){var f=d(e);return"rgb("+(a-f)+","+(b-f)+","+(c-f)+")"}function g(a,b,c,d,e,f){a.fillStyle=f,a.fillRect(b,c,d,e)}function h(a,b,c,d,e,f,g){a.lineWidth=g,a.strokeStyle=f,a.strokeRect(b,c,d,e)}function i(a,b){return Math.atan2(a,b)}function j(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))}function k(){this.hiddenCanvas=document.createElement("canvas"),this.hiddenContext=this.hiddenCanvas.getContext("2d"),this.hiddenCanvas.width=v,this.hiddenCanvas.height=v,this.hiddenContext.lineWidth=w,this.matrix=[];for(var a=u-1;a>=0;a--)for(this.matrix[a]=[],i=t-1;i>=0;i--)this.matrix[a][i]={x:a*v,y:i*v},(6>a||a>=u-6||6>i||i>=t-6)&&(this.matrix[a][i].type=2);for(var b=Math.floor(u/3),h=[[0,e(b,b)]],a=1;t/20>a;a++)h.push([e(20*a,4),e(b,b)]);h.push([t-1,e(b,b)]);for(var a=0;a<h.length-1;a++)this.connectPoints(h[a],h[a+1],2,2);this.intersections=[];for(var a=0;t/10-1>a;a++){this.intersections[a]=[];for(var i=0;u/10-1>i;i++)this.intersections[a][i]=[7+e(10*a,4),7+e(10*i,4)]}for(var a=0;a<this.intersections.length;a++)for(var i=0;i<this.intersections[a].length;i++)a<this.intersections.length-1&&this.connectPoints(this.intersections[a][i],this.intersections[a+1][i],1,5),i<this.intersections[a].length-1&&this.connectPoints(this.intersections[a][i],this.intersections[a][i+1],1,5);for(var j=1e4;j>=0;j--){for(var k=Math.round(c()*t),l=Math.round(c()*u),m=2+Math.round(4*c()),n=!0,a=k;k+m>a&&n;a++)for(var i=l;l+m>i&&n;i++)(a>=t||i>=u||1===this.matrix[a][i].type||2===this.matrix[a][i].type||3===this.matrix[a][i].type)&&(n=!1);if(n){var o=.1+.4*c(),p=d(100);g(this.hiddenContext,0,0,v,v,"rgb("+(p+d(15))+","+(p+d(15))+","+(p+d(15))+")");for(var q=20+d(20),r=10+d(20),s=10+d(20),a=s;v-q>a;a+=q+s)for(var i=r;v-q>i;i+=q+r)g(this.hiddenContext,a,i,q,q,f(76,96,150,70));this.drawNoise(.2);var x=new Image;x.src=this.hiddenCanvas.toDataURL(),g(this.hiddenContext,0,0,v,v,f(70,70,70,5));for(var y=5*w+10*w*c(),a=0;v>a;a+=y)for(var i=0;v>i;i+=y)g(this.hiddenContext,a+w,i+w,y-w,y-w,f(75,75,75,5)),g(this.hiddenContext,a+2*w,i+2*w,y-3*w,y-3*w,f(80,80,80,5));this.drawNoise(.1);var z=new Image;z.src=this.hiddenCanvas.toDataURL();for(var a=k;k+m>a;a++)for(var i=l;l+m>i;i++)this.matrix[a][i].type=3,this.matrix[a][i].height=o,this.matrix[a][i].defaultHeight=o,this.matrix[a][i].wallImage=x,this.matrix[a][i].roofImage=z,this.matrix[a][i].life=1,this.matrix[a][i].lastLife=this.matrix[a][i].life}}for(var a=t-1;a>=0;a--)for(var i=u-1;i>=0;i--)(2===this.matrix[a][i].type||3===this.matrix[a][i].type)&&(this.matrix[a][i].collision=!0)}function l(a,b,e,i){var j,k,l=document.createElement("canvas"),m=l.getContext("2d");if(i)for(;"undefined"==typeof this.x;){for(var n,o=0;!n&&o++<4;){switch(O.carSpawnDirection){case 0:for(var p=I;K>p;p++)1===G.getTile(p,J-1).type&&(n=G.getTile(p,J-1));break;case 1:for(var p=I;K>p&&!n;p++)1===G.getTile(p,L).type&&(n=G.getTile(p,L));break;case 2:for(var p=J;L>p&&!n;p++)1===G.getTile(I-1,p).type&&(n=G.getTile(I-1,p));break;case 3:for(var p=J;L>p&&!n;p++)1===G.getTile(K,p).type&&(n=G.getTile(K,p))}O.carSpawnDirection++,O.carSpawnDirection>3&&(O.carSpawnDirection=0)}n?(this.x=n.x+v/2,this.y=n.y+v/2):(this.x=t/2*v,this.y=u/2*v)}else{j=t/2,k=u/2;for(var n,p=0;t/2-1>p;p++){if(n=G.getTile(k+p,j),1===n.type){this.x=n.x+v/2,this.y=n.y+v/2;break}if(n=G.getTile(k-p,j),1===n.type){this.x=n.x+v/2,this.y=n.y+v/2;break}if(n=G.getTile(k,j+p),1===n.type){this.x=n.x+v/2,this.y=n.y+v/2;break}if(n=G.getTile(k,j-p),1===n.type){this.x=n.x+v/2,this.y=n.y+v/2;break}}}this.width=a,this.height=b,this.speed=0,this.rotation=0,this.inertia=0,this.rotationAngle=.017,this.acelaration=.3,this.deceleration=.05,this.brakeStrength=.3,this.topSpeed=e,this.bot=i,this.firing=!1,this.targetDistance=750,this.life=100,this.lastLife=this.life,this.explosionTick=0,this.firstCollisionPointX=this.x,this.firstCollisionPointY=this.y-b/4,this.secondCollisionPointX=this.x,this.secondCollisionPointY=this.y+b/4,l.width=this.width,l.height=this.height;var q=[d(100),d(100),d(100)],r="rgb("+q[0]+","+q[1]+","+q[2]+")",s=f(50,50,50,20);h(m,6,1,this.width-12,5,"rgb(35,35,35)",2),h(m,1,5,this.width-2,this.height-10,"rgb(35,35,35)",2),h(m,6,this.height-6,this.width-12,5,"rgb(35,35,35)",2),g(m,7,2,this.width-14,4,r),g(m,2,6,this.width-4,this.height-12,r),g(m,7,this.height-6,this.width-14,4,r),g(m,5,30,this.width-10,5,s),g(m,7.5,35,this.width-15,5,s),g(m,10,40,this.width-20,5,s),g(m,10,45,this.width-20,30,"rgb("+(q[0]+5)+","+(q[1]+5)+","+(q[2]+5)+")"),g(m,5,45,2.5,27.5,s),g(m,this.width-7.5,45,2.5,27.5,s),g(m,10,75,this.width-20,5,s),g(m,7.5,80,this.width-15,5,s),g(m,17,10,3,15,s),g(m,30,10,3,15,s);for(var p=0;p<this.width/5;p++)for(var w=0;w<this.height/5;w++)g(m,5*p,5*w,5,5,"rgba(0,0,0,"+.06*c()+")");this.image=new Image,this.image.src=l.toDataURL()}function m(){this.setSettings=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;this.c<.01&&(this.c=.01);var c=this.b+this.c+this.e;if(.18>c){var d=.18/c;this.b*=d,this.c*=d,this.e*=d}}}function n(){this._params=new m;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(a.l>0?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.totalReset=function(){this.reset();var d=this._params;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.synthWave=function(m,n){var o=this._params,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(o.q<0?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,J=5/(1+o.u*o.u*20)*(.01+s);J>.8&&(J=.8),J=1-J;for(var K,L,M,N,O,P,Q=!1,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=new Array(1024),ab=new Array(32),bb=_.length;bb--;)_[bb]=0;for(var bb=ab.length;bb--;)ab[bb]=2*Math.random()-1;for(var bb=0;n>bb;bb++){if(Q)return bb;if(A&&++Z>=A&&(Z=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(Q=!0)),L=d,C>0&&($+=D,L*=1+Math.sin($)*C),L|=0,8>L&&(L=8),E||(k+=l,0>k?k=0:k>.5&&(k=.5)),++S>F)switch(S=0,++R){case 1:F=b;break;case 2:F=c}switch(R){case 0:T=S*G;break;case 1:T=1+2*(1-S*H)*B;break;case 2:T=1-S*I;break;case 3:T=0,Q=!0}x&&(z+=y,M=0|z,0>M?M=-M:M>1023&&(M=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),P=0;for(var cb=8;cb--;){if(X++,X>=L&&(X%=L,3==E))for(var db=ab.length;db--;)ab[db]=2*Math.random()-1;switch(E){case 0:O=k>X/L?.5:-.5;break;case 1:O=1-X/L*2;break;case 2:N=X/L,N=6.28318531*(N>.5?N-1:N),O=1.27323954*N+.405284735*N*N*(0>N?1:-1),O=.225*((0>O?-1:1)*O*O-O)+O;break;case 3:O=ab[Math.abs(32*X/L|0)]}p&&(K=W,s*=t,0>s?s=0:s>.1&&(s=.1),u?(V+=(O-W)*s,V*=J):(W=O,V=0),W+=V,U+=W-K,U*=1-q,O=U),x&&(_[Y%1024]=O,O+=_[(Y-M+1024)%1024],Y++),P+=O}P*=.125*T*v,m[bb]=P>=1?32767:-1>=P?-32768:32767*P|0}return n}}function o(){this.explosion=jsfxr([3,,.1972,.7238,.4589,.0411,,.2774,,,,,,,,.381,,,1,,,,,.3]),this.gunfire=jsfxr([0,,.09,,.09,.5046,,-.6396,,,,,,.0468,,.44,,,1,,,,,.5]),this.gunFireAudio=new Audio,this.gunFireAudio.loop=!0,this.gunFireAudio.src=this.gunfire}function p(){this.charactersData=[[1,1,1,1,0,1,1,0,1,1,0,1,1,1,1],[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],[1,1,1,0,0,1,1,1,1,1,0,0,1,1,1],[1,1,1,0,0,1,1,1,1,0,0,1,1,1,1],[1,0,1,1,0,1,1,1,1,0,0,1,0,0,1],[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1],[1,1,1,1,0,0,1,1,1,1,0,1,1,1,1],[1,1,1,0,0,1,0,1,0,0,1,0,0,1,0],[1,1,1,1,0,1,1,1,1,1,0,1,1,1,1],[1,1,1,1,0,1,1,1,1,0,0,1,0,0,1],[0,0,0,0,1,0,1,1,1,0,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0],[1,1,0,1,0,1,1,1,0,1,0,1,1,0,1],[1,0,1,1,0,1,1,1,1,0,1,0,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,1,0,1,1,0,1,1,1,1,1,0,1],[0,1,1,1,0,0,1,0,0,1,0,1,0,1,1],[0,1,0,1,0,1,1,0,1,1,1,1,1,0,1],[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],[1,1,0,1,0,1,1,0,1,1,0,1,1,0,1],[1,1,1,0,0,1,0,1,0,0,0,0,0,1,0],[1,1,1,1,0,0,1,1,1,0,0,1,1,1,1],[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0],[0,1,0,1,0,1,1,0,1,1,1,1,1,0,1],[1,1,0,1,0,1,1,1,0,1,0,1,1,0,1],[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0],[0,1,0,1,0,1,1,0,1,1,1,1,1,0,1],[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],[1,1,1,1,0,1,1,0,1,1,0,1,1,1,1],[1,1,1,0,1,0,0,1,0,0,1,0,0,1,0]]}function q(){var a=this;D.width=y,D.height=z,this.started=!1,this.keyUp=!1,this.keyDown=!1,this.keyLeft=!1,this.keyRight=!1,this.numbersToDraw=[],this.carSpawnDirection=0,window.addEventListener("keydown",function(b){if(a.started)switch(b.keyCode){case 37:a.keyLeft=!0;break;case 38:a.keyUp=!0;break;case 39:a.keyRight=!0;break;case 40:a.keyDown=!0;break;default:a.car.firing=!0}}),window.addEventListener("keyup",function(b){if(a.started)if(a.car.life<=0)(32===b.keyCode||13===b.keyCode)&&a.tryAgainTimeout>100&&a.init();else switch(b.keyCode){case 37:a.keyLeft=!1;break;case 38:a.keyUp=!1;break;case 39:a.keyRight=!1;break;case 40:a.keyDown=!1;break;default:a.car.firing=!1}else a.started=!0}),D.addEventListener("click",function(){a.started?a.car.life<=0&&a.tryAgainTimeout>100&&a.init():a.started=!0}),this.init(),setInterval(function(){for(var b=I;K>b;b++)for(var c=J;L>c;c++)b>=0&&t>b&&c>=0&&u>c&&!G.getTile(b,c).image&&G.createTile(b,c);a.started&&a.cars.length<5&&a.cars.push(new l(50,100,15,!0));for(var b=a.cars.length-1;b>0;b--)j(a.car.x-a.cars[b].x,a.car.y-a.cars[b].y)>1300&&a.cars.splice(b,1)},100),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame,window.requestAnimationFrame(this.draw.bind(this))}function r(){var a=4/3,b=window.innerWidth,c=window.innerHeight,d=b/c;d>a?(b=c*a,N.style.height=c+"px",N.style.width=b+"px"):(c=b/a,N.style.width=b+"px",N.style.height=c+"px"),N.style.marginTop=-c/2+"px",N.style.marginLeft=-b/2+"px"}b["true"]=a,k.prototype.createTile=function(a,b){switch(this.matrix[a][b].type){case 4:g(this.hiddenContext,0,0,v,v,"rgb(150,0,0)");break;case 3:g(this.hiddenContext,0,0,v,v,"rgb(50,30,0)");break;case 5:g(this.hiddenContext,0,0,v,v,f(80,80,80,8));for(var c=v/5,d=0;v>d;d+=c)for(var e=0;v>e;e+=c)h(this.hiddenContext,d+w/2,e+w/2,d+c,e+c,f(86,86,86,8));break;case 2:g(this.hiddenContext,0,0,v,v,f(65,105,225,4)),a>0&&2!==this.matrix[a-1][b].type&&g(this.hiddenContext,0,0,w,v,"rgb(75,75,75)"),t-1>a&&2!==this.matrix[a+1][b].type&&g(this.hiddenContext,v-w,0,w,v,"rgb(75,75,75)"),b>0&&2!==this.matrix[a][b-1].type&&g(this.hiddenContext,0,0,v,w,"rgb(75,75,75)"),u-1>b&&2!==this.matrix[a][b+1].type&&g(this.hiddenContext,0,v-w,v,w,"rgb(75,75,75)");break;case 1:g(this.hiddenContext,0,0,v,v,f(64,64,64,8)),1!==this.matrix[a-1][b].type&&g(this.hiddenContext,0,0,w,v,"rgb(100,100,100)"),1!==this.matrix[a+1][b].type&&g(this.hiddenContext,v-w,0,w,v,"rgb(100,100,100)"),1!==this.matrix[a][b-1].type&&g(this.hiddenContext,0,0,v,w,"rgb(100,100,100)"),1!==this.matrix[a][b+1].type&&g(this.hiddenContext,0,v-w,v,w,"rgb(100,100,100)"),1===this.matrix[a-1][b].type&&1===this.matrix[a+1][b].type&&g(this.hiddenContext,0+5*w,v/2-w/2,5*w,w,"rgb(90,90,90)"),1===this.matrix[a][b-1].type&&1===this.matrix[a][b+1].type&&g(this.hiddenContext,0+v/2-w/2,5*w,w,5*w,"rgb(90,90,90)");break;default:g(this.hiddenContext,0,0,v,v,f(0,100,0,8))}this.drawNoise(.1),this.matrix[a][b].image=new Image,this.matrix[a][b].image.src=this.hiddenCanvas.toDataURL()},k.prototype.connectPoints=function(a,b,c,d){a[0],b[1];if(b[0]>a[0])for(var e=a[0];e<=b[0];e++)this.matrix[e][a[1]-1].type||(this.matrix[e][a[1]-1].type=d),this.matrix[e][a[1]].type=c,this.matrix[e][a[1]+1].type||(this.matrix[e][a[1]+1].type=d);else for(var e=b[0];e<=a[0];e++)this.matrix[e][a[1]-1].type||(this.matrix[e][a[1]-1].type=d),this.matrix[e][a[1]].type=c,this.matrix[e][a[1]+1].type||(this.matrix[e][a[1]+1].type=d);if(b[1]>a[1])for(var e=a[1];e<b[1];e++)this.matrix[b[0]-1][e].type||(this.matrix[b[0]-1][e].type=d),this.matrix[b[0]][e].type=c,b[0]<t-1&&!this.matrix[b[0]+1][e].type&&(this.matrix[b[0]+1][e].type=d);else for(var e=b[1];e<a[1];e++)this.matrix[b[0]-1][e].type||(this.matrix[b[0]-1][e].type=d),this.matrix[b[0]][e].type=c,b[0]<t-1&&!this.matrix[b[0]+1][e].type&&(this.matrix[b[0]+1][e].type=d)},k.prototype.drawNoise=function(a){for(var b=0;v/w>b;b++)for(var d=0;v/w>d;d++)g(this.hiddenContext,b*w,d*w,w,w,"rgba(0,0,0,"+c()*a+")")},k.prototype.getTile=function(a,b){return this.matrix[a][b]},k.prototype.getTileByCoordinates=function(a,b){return this.getTile(Math.floor(a/v),Math.floor(b/v))},l.prototype.accelerate=function(){this.speed=this.speed>this.topSpeed?this.topSpeed:this.speed+this.acelaration},l.prototype.decelerate=function(){this.speed>this.deceleration?this.speed-=this.deceleration:this.speed<-this.deceleration?this.speed+=this.deceleration:this.speed=0},l.prototype.brake=function(){this.speed=this.speed<-this.topSpeed?-this.topSpeed:this.speed-this.brakeStrength},l.prototype.stop=function(){this.speed=this.speed>0?this.speed-this.brakeStrength:0},l.prototype.updatePosition=function(){if(O.car.life<=0||this.life<=0)return void(this.firing=!1);var a=this.speed*Math.sin(this.inertia),b=this.speed*Math.cos(this.inertia);if(this.x+=a,this.y-=b,this.bot)this.rotation=i(O.car.y-this.y,O.car.x-this.x)+Math.PI/2,this.rotation>2*Math.PI&&(this.rotation=this.rotation-2*Math.PI);else{O.keyUp?this.accelerate():this.decelerate(),O.keyDown&&this.brake();var c=0;this.speed>1||this.speed<-1?c=this.rotationIncrement/4:(this.speed>1||this.speed<-1)&&(c=this.rotationIncrement/4),O.keyLeft&&(this.rotation-=this.rotationAngle*this.speed/2,this.rotation<0&&(this.rotation=2*Math.PI+this.rotation,this.inertia=2*Math.PI+this.inertia)),O.keyRight&&(this.rotation+=this.rotationAngle*this.speed/2,this.rotation>2*Math.PI&&(this.rotation=this.rotation-2*Math.PI,this.inertia=this.inertia-2*Math.PI))}this.rotation>this.inertia?this.inertia+=(this.rotation-this.inertia)/10:this.rotation<this.inertia&&(this.inertia-=(this.inertia-this.rotation)/10);for(var d=!0,e=0;d;e+=30){var f=this.x+e*Math.sin(this.rotation),g=this.y-e*Math.cos(this.rotation),h=G.getTileByCoordinates(f,g);if(3===h.type){this.bot&&!this.firing&&(this.firing=!0,(I*v>f||f>K*v||J*v>g||g>L*v)&&(h.type=6,h.collision=!1,h.explosionTick=100)),this.firing&&(this.targetDistance=e,h.life--),this.bot&&this.decelerate(),d=!1;break}if(this.bot&&e>500){this.firing&&(this.firing=!1),this.accelerate(),d=!1;break}if(!this.bot&&e>800){this.targetDistance=800,d=!1;break}for(var k=O.cars.length-1;k>=0;k--)if(O.cars[k]!==this&&O.cars[k].life>0&&(j(f-O.cars[k].firstCollisionPointX,g-O.cars[k].firstCollisionPointY)<O.cars[k].width||j(f-O.cars[k].secondCollisionPointX,g-O.cars[k].secondCollisionPointY)<O.cars[k].width)){if(this.bot&&O.cars[k].bot)return;this.bot&&!this.firing&&(this.firing=!0),this.firing&&(this.targetDistance=e,O.cars[k].life-=this.bot?.1:2),this.bot&&j(this.x-O.car.x,this.y-O.car.y)<500&&this.stop(),d=!1;break}}this.firstCollisionPointX=this.x+this.width/2*Math.sin(this.rotation),this.firstCollisionPointY=this.y-this.width/2*Math.cos(this.rotation),this.secondCollisionPointX=this.x-this.width/2*Math.sin(this.rotation),this.secondCollisionPointY=this.y+this.width/2*Math.cos(this.rotation);for(var l=[G.getTileByCoordinates(this.firstCollisionPointX+this.width/2,this.firstCollisionPointY).collision,G.getTileByCoordinates(this.firstCollisionPointX-this.width/2,this.firstCollisionPointY).collision,G.getTileByCoordinates(this.firstCollisionPointX,this.firstCollisionPointY+this.width/2).collision,G.getTileByCoordinates(this.firstCollisionPointX,this.firstCollisionPointY-this.width/2).collision,G.getTileByCoordinates(this.secondCollisionPointX+this.width/2,this.secondCollisionPointY).collision,G.getTileByCoordinates(this.secondCollisionPointX-this.width/2,this.secondCollisionPointY).collision,G.getTileByCoordinates(this.secondCollisionPointX,this.secondCollisionPointY+this.width/2).collision,G.getTileByCoordinates(this.secondCollisionPointX,this.secondCollisionPointY-this.width/2).collision],m=0,e=3;e>=0;e--)l[e]&&m++;m>1?(this.x-=a,this.y+=b,this.inertia=this.rotation,this.speed=-this.speed/2):(l[0]||l[5]?(this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?this.rotation+=.1:this.rotation-=.1,this.inertia=this.rotation):l[1]||l[4]?(this.rotation>Math.PI/2&&this.rotation<3*Math.PI/2?this.rotation-=.1:this.rotation+=.1,this.inertia=this.rotation):l[2]||l[7]?(this.rotation>Math.PI?this.rotation+=.1:this.rotation-=.1,this.inertia=this.rotation):(l[3]||l[6])&&(this.rotation>Math.PI?this.rotation-=.1:this.rotation+=.1,this.inertia=this.rotation),l[0]||l[4]?this.x-=((l[0]?this.firstCollisionPointX:this.secondCollisionPointX)+this.width/2)%v+1:l[1]||l[5]?this.x+=v-((l[1]?this.firstCollisionPointX:this.secondCollisionPointX)-this.width/2)%v+1:l[2]||l[6]?this.y-=((l[2]?this.firstCollisionPointY:this.secondCollisionPointY)+this.width/2)%v+1:(l[3]||l[7])&&(this.y+=v-((l[3]?this.firstCollisionPointY:this.secondCollisionPointY)-this.width/2)%v+1));for(var e=O.cars.length-1;e>=0;e--)if(O.cars[e]!==this){var n=this.detectCollisionWithCar(O.cars[e]);0>n&&(O.cars[e].x>this.x?(O.cars[e].x-=n,this.x+=n):(O.cars[e].x+=n,this.x-=n),O.cars[e].y>this.y?(O.cars[e].y-=+n,this.y+=n):(O.cars[e].y+=n,this.y-=n))}},l.prototype.detectCollisionWithCar=function(a){var b=j(this.firstCollisionPointX-a.firstCollisionPointX,this.firstCollisionPointY-a.firstCollisionPointY)-this.width;return 0>b?b:(b=j(this.firstCollisionPointX-a.secondCollisionPointX,this.firstCollisionPointY-a.secondCollisionPointY)-this.width,0>b?b:(b=j(this.secondCollisionPointX-a.firstCollisionPointX,this.secondCollisionPointY-a.firstCollisionPointY)-this.width,0>b?b:(b=j(this.secondCollisionPointX-a.secondCollisionPointX,this.secondCollisionPointY-a.secondCollisionPointY)-this.width,0>b?b:void 0)))},l.prototype.draw=function(a){if(E.save(),E.translate(this.x,this.y),E.rotate(this.rotation),this.life<=0)if(0===this.explosionTick&&this.bot&&(O.points+=500,O.numbersToDraw.push([this.x,this.y-this.width,500,0,!0])),this.explosionTick>=100){for(var b=O.cars.length-1;b>=0;b--)if(O.cars[b]===this){O.cars.splice(b,1);break}}else{for(var b=0;b<this.width;b+=10)for(var d=0;d<this.height;d+=10){var e=c()>.4?this.explosionTick/5:-this.explosionTick/5,f=c()>.4?this.explosionTick/5:-this.explosionTick/5;g(E,b-this.width/2+e,d-this.height/2+f,10-this.explosionTick/10,10-this.explosionTick/10,"rgb(255,"+2*this.explosionTick+",0)")}this.explosionTick++}else if(E.drawImage(this.image,-this.width/2,-this.height/2),this.life!==this.lastLife&&(a%5===0&&g(E,-this.width/2,-this.height/2,this.width,this.height,"rgba(255,0,0, 0.3)"),a%15===0&&("undefined"==typeof this.lastLifeValueShown&&(this.lastLifeValueShown=this.lastLife),this.lastLifeValueShown-this.life>.5&&(O.numbersToDraw.push([this.x,this.y-this.width,this.bot?this.lastLifeValueShown-this.life:-1*(this.lastLifeValueShown-this.life),0,this.bot]),this.lastLifeValueShown=this.life)),this.lastLife=this.life),a=a%5*10,this.firing){g(E,-8,-this.height/2-10-a,3,20,"rgb(255,140,0)"),g(E,5,-this.height/2-10-a,3,20,"rgb(255,140,0)");for(var d=this.height;d<this.targetDistance-O.car.width/2;d+=50)g(E,-8,-d-a,3,20,"rgb(255,140,0)"),g(E,5,-d-a,3,20,"rgb(255,140,0)")}E.restore()};var s=new n;window.jsfxr=function(a){s._params.setSettings(a);var b=s.totalReset(),c=new Uint8Array(4*((b+1)/2|0)+44),d=2*s.synthWave(new Uint16Array(c.buffer,44),b),e=new Uint32Array(c.buffer,0,44);e[0]=1179011410,e[1]=d+36,e[2]=1163280727,e[3]=544501094,e[4]=16,e[5]=65537,e[6]=44100,e[7]=88200,e[8]=1048578,e[9]=1635017060,e[10]=d,d+=44;for(var f=0,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";d>f;f+=3){var i=c[f]<<16|c[f+1]<<8|c[f+2];h+=g[i>>18]+g[i>>12&63]+g[i>>6&63]+g[63&i]}return h},p.prototype.drawNumber=function(a,b,c,d,e,f,g,h){var i=[],j=Math.abs(Math.ceil(c)),k=4*f;if(0===j)i.push(0);else{for(;j>0;)i.push(j%10),j=Math.floor(j/10);g&&(c>0?i.push(10):0>c&&i.push(11))}"right"===h?a-=16*i.length:"left"===h&&(a+=16*i.length);for(var l=0;l<i.length;l++)this.drawCharacter(a+i.length/2*k-k-l*k,b,i[l],d,e,f)},p.prototype.drawCharacter=function(a,b,c,d,e,f){for(var i=this.charactersData[c],j=0;3>j;j++)for(var k=0;5>k;k++)i[3*k+j]&&h(E,a+j*f,b+k*f,f+.5,f+.5,e,5);for(var j=0;3>j;j++)for(var k=0;5>k;k++)i[3*k+j]&&g(E,a+j*f,b+k*f,f+.5,f+.5,d)},p.prototype.drawStart=function(){for(var a=0;5>a;a++)H.drawCharacter(A-80+35*a,B+100,a+22,"rgb(178,34,34)","rgb(20,20,20)",8)},p.prototype.drawFinalPoints=function(){var a=O.points.toString().length;if(a>15)for(var b=0;4>b;b++)H.drawCharacter(A-200+110*b,B-200,b+27,"rgb(65,105,225)","rgb(20,20,20)",32);else H.drawNumber(A,B-200,O.points,"rgb(65,105,225)","rgb(20,20,20)",a>6?32-2*(a-6):32)},p.prototype.drawTryAgain=function(){for(var a=0;10>a;a++)H.drawCharacter(A-150+30*a,B+50,a+12,"rgb(178,34,34)","rgb(20,20,20)",8)},p.prototype.drawPointsAndLife=function(){var a=O.points.toString().length;if(a>15)for(var b=0;4>b;b++)H.drawCharacter(y-140+32*b,z-50,b+27,"rgb(65,105,225)","rgb(20,20,20)",8);else H.drawNumber(y-12,z-58,O.points,"rgb(65,105,225)","rgb(20,20,20)",8,!1,"right");H.drawNumber(16,z-58,O.car.life,"rgb(178,34,34)","rgb(20,20,20)",8,!0,"left")};var t=100,u=100,v=200,w=10,x=5,y=1024,z=768,A=y/2,B=z/2,C=4,D=document.getElementById("canvas"),E=D.getContext("2d"),F=new o,G=new k,H=new p,I=0,J=0,K=0,L=0,M=0;q.prototype.init=function(){var a;this.points=0,this.tryAgainTimeout=0,this.keyLeft=!1,this.keyUp=!1,this.keyRight=!1,this.keyDown=!1;for(var b=t-1;b>=0;b--)for(var c=u-1;c>=0;c--)a=G.getTile(b,c),6===a.type&&(a.type=3,a.collision=!0,a.explosionTick=0,a.life=1,a.height=a.defaultHeight);this.cars=[this.car=new l(50,100,18,!1)]},q.prototype.drawHorizontalWall=function(a,b,c,d,e,f,h,i){for(var j=d-a,k=e-b,l=c-f,m=j/k,n=l/k,o=v/k,p=0;k>p;p+=x)E.drawImage(h,0,o*p,v,x,a,b+p,c,x),i&&g(E,a,b+p,c,x,"rgba(255,0,0, 0.3)"),a+=m*x,c-=n*x},q.prototype.drawVerticalWall=function(a,b,c,d,e,f,h,i){for(var j=d-a,k=e-b,l=c-f,m=k/j,n=l/j,o=v/j,p=0;j>p;p+=x)E.drawImage(h,o*p,0,x,v,a+p,b,x,c),i&&g(E,a+p,b,x,c,"rgba(255,0,0, 0.3)"),b+=m*x,c-=n*x},q.prototype.draw=function(){M++,M>100&&(M=0),E.save(),E.clearRect(0,0,y,z);var a=.9-Math.abs(this.car.speed)/110;E.translate(A,B),E.scale(a,a),E.translate(-A,-B);var b=-this.car.x+A,c=-this.car.y+B;E.translate(b,c),I=Math.floor(this.car.x/v)-C,J=Math.floor(this.car.y/v)-C+1,K=I+2*C+1,L=J+2*C;for(var d=I;K>d;d++)for(var e=J;L>e;e++){var f=G.getTile(d,e);f.image&&3!==f.type&&(E.drawImage(f.image,f.x,f.y),6===f.type&&f.explosionTick<=10&&(g(E,f.x,f.y,v,v,"rgba(100,100,100,"+(1-f.explosionTick/10)+")"),f.explosionTick++))}for(var d=this.cars.length-1;d>=0;d--)this.cars[d].updatePosition();for(var d=this.cars.length-1;d>=0;d--)this.cars[d].draw(M);for(var h=!1,d=this.cars.length-1;d>=0;d--)this.cars[d].firing&&F.gunFireAudio.paused&&(F.gunFireAudio.play(),h=!0);h||F.gunFireAudio.paused||F.gunFireAudio.pause();for(var i,d=I;K>d;d++)for(var e=J;L>e;e++){var f=G.getTile(d,e),j=f.life!==f.lastLife&&M%5===0;if(d>=0&&t>d&&e>=0&&u>e&&f.image&&3===f.type){var k=f.x+(f.x+b-A)*f.height,l=f.y+(f.y+c-B)*f.height,m=v+f.height*v;i=G.getTile(d,e+1),(3!==i.type||i.height<f.height)&&(3===i.type?(tilePositionX=i.x+(i.x+b-A)*i.height,tilePositionY=i.y+(i.y+c-B)*i.height,tileWidth=v+i.height*v):(tilePositionX=f.x,tilePositionY=f.y+v,tileWidth=v),O.drawHorizontalWall(k,l+m,m,tilePositionX,tilePositionY,tileWidth,f.wallImage,j)),i=G.getTile(d,e-1),(3!==i.type||i.height<f.height)&&(3===i.type?(tilePositionX=i.x+(i.x+b-A)*i.height,tilePositionY=i.y+(i.y+c-B)*i.height+v+i.height*v,tileWidth=v+i.height*v):(tilePositionX=f.x,tilePositionY=f.y,tileWidth=v),O.drawHorizontalWall(tilePositionX,tilePositionY,tileWidth,k,l,m,f.wallImage,j)),i=G.getTile(d+1,e),(3!==i.type||i.height<f.height)&&(3===i.type?(tilePositionX=i.x+(i.x+b-A)*i.height,tilePositionY=i.y+(i.y+c-B)*i.height,tileWidth=v+i.height*v):(tilePositionX=f.x+v,tilePositionY=f.y,tileWidth=v),O.drawVerticalWall(k+m,l,m,tilePositionX,tilePositionY,tileWidth,f.wallImage,j)),i=G.getTile(d-1,e),(3!==i.type||i.height<f.height)&&(3===i.type?(tilePositionX=i.x+(i.x+b-A)*i.height+v+i.height*v,tilePositionY=i.y+(i.y+c-B)*i.height,tileWidth=v+i.height*v):(tilePositionX=f.x,tilePositionY=f.y,tileWidth=v),O.drawVerticalWall(tilePositionX,tilePositionY,tileWidth,k,l,m,f.wallImage,j))}}for(var d=I;K>d;d++)for(var e=J;L>e;e++){var f=G.getTile(d,e);if(d>=0&&t>d&&e>=0&&u>e&&f.image&&3===f.type){var k=f.x+(f.x+b-A)*f.height,l=f.y+(f.y+c-B)*f.height,m=v+f.height*v;if(E.drawImage(f.roofImage,k,l,m,m),f.life!==f.lastLife&&(M%5===0&&g(E,k,l,m,m,"rgba(255,0,0, 0.3)"),M%15===0&&("undefined"==typeof f.lastLifeValueShown&&(f.lastLifeValueShown=f.lastLife),this.numbersToDraw.push([f.x+v/2,f.y+v/2,f.lastLifeValueShown-f.life,0,!0]),f.lastLifeValueShown=f.life),f.lastLife=f.life),f.life<=0&&(f.height-=.02),f.height<=0){var n=new Audio;n.src=F.explosion,n.play(),this.points+=30,this.numbersToDraw.push([f.x+v/2,f.y+v/2,30,0,!0]),f.type=6,f.collision=!1,f.explosionTick=0}}}for(var d=this.numbersToDraw.length-1;d>=0;d--){var o=this.numbersToDraw[d];o[3]+=2,H.drawNumber(o[0],o[1]-3*o[3],o[2],o[4]?"rgba(65,105,225,"+(1-.01*o[3])+")":"rgba(178,34,34,"+(1-.01*o[3])+")","rgba(20,20,20,"+(1-.02*o[3])+")",8,!0),o[3]>=100&&this.numbersToDraw.splice(d,1)}E.restore(),this.started?this.car.life<=0?(H.drawFinalPoints(),this.tryAgainTimeout>100&&H.drawTryAgain(),this.tryAgainTimeout++):H.drawPointsAndLife():H.drawStart(),requestAnimationFrame(this.draw.bind(this))};var N=document.getElementById("gameArea");window.addEventListener("resize",r,!1),window.addEventListener("orientationchange",r,!1),r();var O=new q}({},function(){return this}());